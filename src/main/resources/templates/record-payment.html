<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Record Payment - [[${farmer.buildFullName()}]]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; padding: 40px 0; }
        .container { max-width: 800px; }
        .card { border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .header { background: #17a2b8; color: white; padding: 30px; text-align: center; border-radius: 20px 20px 0 0; }
        .form-label { font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <div class="header">
            <h1 class="display-5">RECORD PAYMENT</h1>
            <h3 th:text="${farmer.buildFullName()}">Farmer Name</h3>
            <p>ID: <strong th:text="${farmer.farmerId}">F001</strong></p>
            <p class="fs-4 mt-3">Current Net Payable: 
                <span class="badge bg-success fs-3" th:text="'KES ' + ${#numbers.formatInteger(netPayable, 0, 'COMMA')}">0</span>
            </p>
        </div>

        <div class="card-body p-5">
            <form th:action="@{/clerk/record-payment/{id}(id=${farmer.farmerId})}" th:object="${payment}" method="post">
                <div class="row g-4">
                    <!-- PHONE NUMBER FIELD (NEW) -->
                    <div class="col-12">
                        <label class="form-label">Phone Number *</label>
                        <input type="text" th:field="*{farmerPhone}" class="form-control form-control-lg" 
                               placeholder="e.g. 254708374149 (sandbox test number)" required />
                        <small class="text-muted">Use 254708374149 for M-Pesa sandbox testing</small>
                    </div>

                    <div class="col-md-6">
                        <label class="form-label">Amount Paid (KES) *</label>
                        <input type="number" step="0.01" min="0" th:field="*{amountPaid}" 
                               class="form-control form-control-lg" required />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Payment Method *</label>
                        <select th:field="*{paymentMethod}" class="form-select form-select-lg" required>
                            <option value="">Choose...</option>
                            <option value="CASH">Cash</option>
                            <option value="MPESA">M-Pesa</option>
                            <option value="BANK">Bank Transfer</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <label class="form-label">Reference / Transaction Code</label>
                        <input type="text" th:field="*{referenceNumber}" class="form-control form-control-lg" 
                               placeholder="e.g. ABC123XYZ for M-Pesa" />
                    </div>
                    <div class="col-12">
                        <label class="form-label">Payment Date</label>
                        <input type="date" th:field="*{paymentDate}" class="form-control form-control-lg" required />
                    </div>
                    <div class="col-12">
                        <label class="form-label">Notes (Optional)</label>
                        <textarea th:field="*{notes}" class="form-control" rows="4"></textarea>
                    </div>
                </div>

                <div class="text-center mt-5">
                    <button type="submit" class="btn btn-success btn-lg px-5">
                        <i class="bi bi-check-circle"></i> Record Payment
                    </button>
                    <a th:href="@{/clerk/payment-statement/{id}(id=${farmer.farmerId})}" 
                       class="btn btn-secondary btn-lg px-5 ms-3">
                        <i class="bi bi-x-circle"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>