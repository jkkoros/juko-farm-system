<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Record Employee Salary Payment</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { 
            background: linear-gradient(135deg, #667eea, #764ba2); 
            min-height: 100vh; 
        }
        .card { 
            max-width: 750px; 
            margin: 50px auto; 
            border-radius: 25px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.3); 
        }
        .header { 
            background: #1e3a8a; 
            color: white; 
            padding: 30px; 
            text-align: center; 
            border-radius: 25px 25px 0 0; 
        }
        .alert-info strong { font-size: 1.2rem; }
        .overdraft-alert { border-left: 5px solid #dc3545; }
    </style>
</head>
<body>
<div class="card">
    <div class="header">
        <h1 class="display-5 fw-bold">RECORD SALARY PAYMENT</h1>
    </div>

    <div class="card-body p-5 bg-white">
        <div class="text-center mb-4">
            <h3 class="fw-bold" th:text="${employee.buildFullName()}">John Doe</h3>
            <p class="fs-4 text-success">ID: <strong th:text="${employee.employeeId}">E001</strong></p>
            <p>Role: <span class="badge bg-primary fs-5" th:text="${employee.role}">Manager</span></p>
        </div>

        <!-- Overdraft Recovery Alert -->
        <div th:if="${overdraft > 0}" class="alert alert-danger overdraft-alert text-center mb-4">
            <i class="bi bi-exclamation-triangle-fill fs-3"></i><br>
            <strong>Overdraft Recovery This Month:</strong><br>
            KES <span class="fs-3" th:text="${#numbers.formatInteger(overdraft, 0, 'COMMA')}">6,000</span>
            <p class="mt-2">This amount will be automatically deducted from salary.</p>
        </div>

        <!-- Salary Summary -->
        <div class="alert alert-info text-center mb-4">
            <strong>Monthly Salary:</strong> 
            <span class="fs-4" th:text="'KES ' + ${#numbers.formatInteger(monthlySalary, 0, 'COMMA')}">15,000</span>
            <br th:if="${overdraft > 0}" />
            <span th:if="${overdraft > 0}" class="text-danger">
                <strong>After Recovery:</strong> 
                KES <span th:text="${#numbers.formatInteger(maxPayable, 0, 'COMMA')}">9,000</span>
            </span>
            <span th:if="${overdraft == 0}" class="text-success">
                <strong>Full Amount Payable:</strong> 
                KES <span th:text="${#numbers.formatInteger(maxPayable, 0, 'COMMA')}">15,000</span>
            </span>
        </div>

        <!-- Warning if trying to overpay -->
        <div class="alert alert-warning text-center" th:if="${maxPayable < monthlySalary}">
            <i class="bi bi-info-circle"></i> 
            Paying more than KES <span th:text="${#numbers.formatInteger(monthlySalary, 0, 'COMMA')}"></span> 
            will create an overdraft (advance) to recover next month.
        </div>

        <form th:action="@{'/clerk/record-employee-payment/' + ${employee.employeeId}}"
              th:object="${payment}" method="post">

            <input type="hidden" th:field="*{employeeId}" />
            <input type="hidden" th:field="*{employeeName}" />
            <input type="hidden" th:field="*{employeePhone}" />
            <input type="hidden" th:field="*{grossSalary}" />
            <input type="hidden" th:field="*{deductions}" /> <!-- will store recovered overdraft -->

            <div class="row g-4">
                <div class="col-md-6">
                    <label class="fw-bold">Amount to Pay (KES) *</label>
                    <input type="number" step="0.01" min="0" 
                           th:field="*{amountPaid}" 
                           class="form-control form-control-lg" 
                           placeholder="e.g., 9000" required />
                    <small class="text-muted">
                        Default: <strong th:text="${#numbers.formatInteger(maxPayable, 0, 'COMMA')}">9,000</strong> 
                        (after overdraft recovery)
                    </small>
                </div>

                <div class="col-md-6">
                    <label class="fw-bold">Payment Method *</label>
                    <select th:field="*{paymentMethod}" class="form-select form-select-lg" required>
                        <option value="">Select Method</option>
                        <option value="M-Pesa">M-Pesa</option>
                        <option value="Bank Transfer">Bank Transfer</option>
                        <option value="Cash">Cash</option>
                    </select>
                </div>

                <div class="col-md-6">
                    <label class="fw-bold">Reference Number</label>
                    <input type="text" th:field="*{referenceNumber}" 
                           class="form-control form-control-lg" 
                           placeholder="e.g., MPESA123XYZ" />
                </div>

                <div class="col-md-6">
                    <label class="fw-bold">Payment Date *</label>
                    <input type="date" th:field="*{paymentDate}" 
                           class="form-control form-control-lg" required />
                </div>
            </div>

            <div class="text-center mt-5">
                <button type="submit" class="btn btn-success btn-lg px-5">
                    <i class="bi bi-check-circle"></i> Record Payment
                </button>
                <a th:href="@{/employees/all}" class="btn btn-secondary btn-lg px-5 ms-3">
                    Cancel
                </a>
            </div>
        </form>

        <div class="text-center mt-4">
            <a th:href="@{'/clerk/employee-payment-statement/' + ${employee.employeeId}}"
               class="btn btn-info btn-lg">
                <i class="bi bi-clock-history"></i> View Payment History
            </a>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>