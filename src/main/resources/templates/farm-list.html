<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Juko Farm - Farms List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .container { padding: 40px 20px; }
        .card { border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .photo-img { width: 100px; height: 80px; object-fit: cover; border-radius: 12px; border: 3px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .no-photo { opacity: 0.4; filter: grayscale(100%); }
        .btn-upload { font-size: 0.9rem; }
    </style>
</head>
<body class="text-white">
<div class="container">
    <div class="text-center mb-5">
        <h1 class="display-3 fw-bold">MY FARMS</h1>
        <p class="lead">Logged in as: <strong sec:authentication="name">User</strong></p>
        <a th:href="@{/dashboard}" class="btn btn-light btn-lg">Back to Dashboard</a>
        <a th:href="@{/farms/new}" class="btn btn-success btn-lg ms-3">Add New Farm</a>
    </div>

    <div class="card bg-white text-dark">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Farm Name</th>
                        <th>Location</th>
                        <th>Size (Acres)</th>
                        <th>Photo</th>
                        <th>Upload Photo</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="farm : ${farms}" class="align-middle">
                        <td th:text="${farm.id}"></td>
                        <td><strong th:text="${farm.name}"></strong></td>
                        <td th:text="${farm.location}"></td>
                        <td th:text="${farm.sizeInAcres}"></td>

                        <!-- PHOTO DISPLAY -->
                        <td class="text-center">
                            <img th:if="${farm.photo != null}" 
                                 th:src="@{'/uploads/' + ${farm.photo}}" 
                                 alt="Farm photo" class="photo-img" />
                            <img th:unless="${farm.photo != null}" 
                                 src="/images/no-photo.jpg" 
                                 alt="No photo" class="photo-img no-photo" />
                        </td>

                        <!-- PHOTO UPLOAD -->
                        <td>
                            <form th:action="@{/farms/upload-photo/{id}(id=${farm.id})}" 
                                  method="post" enctype="multipart/form-data" class="d-inline">
                                <input type="file" name="photo" accept="image/*" 
                                       class="form-control form-control-sm btn-upload" 
                                       onchange="this.form.submit()" />
                            </form>
                        </td>

                        <!-- ACTIONS -->
                        <td>
                            <a th:href="@{/farms/edit/{id}(id=${farm.id})}" 
                               class="btn btn-warning btn-sm">Edit</a>
                            
                            <form th:action="@{/farms/delete/{id}(id=${farm.id})}" 
                                  method="post" class="d-inline"
                                  onsubmit="return confirm('Delete farm [[${farm.name}]] permanently?')">
                                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <div th:if="${#lists.isEmpty(farms)}" class="text-center py-5">
                    <h3>No farms found</h3>
                    <a th:href="@{/farms/new}" class="btn btn-success btn-lg mt-3">Create Your First Farm</a>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>