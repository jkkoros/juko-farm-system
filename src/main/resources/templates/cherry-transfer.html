<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Transfer Cherry Kg - Juko Coffee Factory</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #11998e, #38ef7d); min-height: 100vh; }
        .card { max-width: 1100px; margin: 50px auto; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: #155724; color: white; padding: 40px; text-align: center; }
        .form-bg { background: white; padding: 50px; }
        .table-panel { background: #f8f9fa; padding: 30px; border-radius: 15px; margin-top: 40px; }
    </style>
</head>
<body>
<div class="card">
    <div class="header">
        <h1 class="display-5 fw-bold">TRANSFER CHERRY KG</h1>
        <p class="fs-4">Between Farmers</p>
    </div>

    <div class="form-bg">
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show">
            <strong>Error!</strong> <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show">
            <strong>Success!</strong> <span th:text="${successMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <form th:action="@{/cherry/transfer}" th:object="${transfer}" method="post">
            <div class="row g-4">
                <div class="col-md-6">
                    <label class="form-label fw-bold fs-4">From Farmer ID *</label>
                    <input type="text" th:field="*{fromFarmerId}" class="form-control form-control-lg" required autofocus />
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold fs-4">To Farmer ID *</label>
                    <input type="text" th:field="*{toFarmerId}" class="form-control form-control-lg" required />
                </div>
                <div class="col-12">
                    <label class="form-label fw-bold fs-4">Kg to Transfer *</label>
                    <input type="number" step="0.01" min="0.01" th:field="*{kilosTransferred}" class="form-control form-control-lg" required />
                </div>
                <div class="col-12">
                    <label class="form-label fw-bold fs-4">Date *</label>
                    <input type="date" th:field="*{transferDate}" class="form-control form-control-lg" required />
                </div>
                <div class="col-12">
                    <label class="form-label fw-bold fs-4">Notes (Optional)</label>
                    <textarea th:field="*{notes}" class="form-control" rows="3"></textarea>
                </div>
            </div>

            <div class="text-center mt-5">
                <button type="submit" class="btn btn-warning btn-lg px-5">
                    <i class="bi bi-arrow-left-right me-2"></i> TRANSFER KG
                </button>
                <a th:href="@{/cherry}" class="btn btn-secondary btn-lg px-5 ms-3">Back</a>
            </div>
        </form>

        <!-- TRANSFER HISTORY TABLE -->
        <div class="table-panel" th:if="${transfers != null && !transfers.isEmpty()}">
            <h3 class="text-success text-center mb-4">Transfer History</h3>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-success">
                        <tr>
                            <th>Date</th>
                            <th>From Farmer</th>
                            <th>To Farmer</th>
                            <th>Kg</th>
                            <th>Notes</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="t : ${transfers}">
                            <td th:text="${#temporals.format(t.transferDate, 'dd MMM yyyy')}"></td>
                            <td>
                                <strong th:text="${t.fromFarmerId}"></strong><br>
                                <small class="text-muted" th:text="${t.notes.split('From: ')[1].split(' \\| To: ')[0]}">Name</small>
                            </td>
                            <td>
                                <strong th:text="${t.toFarmerId}"></strong><br>
                                <small class="text-muted" th:text="${t.notes.split(' \\| To: ')[1]}">Name</small>
                            </td>
                            <td th:text="${t.kilosTransferred}"></td>
                            <td th:text="${t.notes.split('From: ')[0] ?: 'â€”'}"></td>
                            <td>
                                <form th:action="@{'/cherry/transfer/undo/' + ${t.id}}" method="post" class="d-inline"
                                      onsubmit="return confirm('Undo this transfer? This action cannot be reversed.');">
                                    <button type="submit" class="btn btn-danger btn-sm">
                                        <i class="bi bi-arrow-counterclockwise"></i> Undo
                                    </button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="text-center py-5 text-muted" th:if="${transfers == null or transfers.isEmpty()}">
            <i class="bi bi-inbox fs-1 d-block mb-3"></i>
            No transfers recorded yet
        </div>
    </div>
</div>
</body>
</html>